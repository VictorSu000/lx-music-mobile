源码使用方法

# 环境要求
Node.js 16+（直接最新稳定版就行）

# 环境准备

- 安装Node.js环境: 下载Node.js安装结束后，打开命令行输入node -v将会输出Node.js的版本号即表示已安装完成。nodejs在win的安装会提示装chocolate和VS编译工具，建议安装
- 安装java：choco install -y microsoft-openjdk17 （前两步，建议先装chocolate，然后按照后面那个React Native CLI Quickstart的介绍来装）
- 安装Android开发环境: 可以直接安装android studio，可参考[React Native CLI Quickstart](https://reactnative.dev/docs/environment-setup)。注意android studio安装需要代理，可以考虑gost将带密码的http代理转shadowsocks，再用ss客户端开全局代理，android studio连接ss客户端（其实可以直接用http代理的方式连ss客户端）。如果系统有wsl2之类的用到hyper-v的，android studio自带模拟器没法用，可以安装bluestacks之类的兼容的模拟器。（但安装bluestacks之后自带模拟器又能用了，奇怪）如果android studio启动提示端口被占用，可以参照https://blog.csdn.net/m0_47746013/article/details/130577554、https://doracoin.cc/343/，处理后重启电脑
    ```bash
    netsh int ipv4 set dynamicport tcp start=49152 num=16383
    netsh int ipv4 set dynamicport udp start=49152 num=16383
    netsh winsock reset
    # 需要管理员权限的powershell执行
    ```
- 拉取代码: 克隆本仓库代码
- 全局安装yarn（后续不要用yarn装依赖，但得有yarn，因为后面github包里用了yarn...）
- 安装依赖: 在项目根目录打开命令行，执行命令：npm install。注意不能用yarn，用yarn会忽略package-lock.json，导致安装的包版本不同，新版本的包会导致编译打包失败。如果墙内网络需要设置各种代理，参照：
    ```bash
    npm config set registry https://registry.npmmirror.com
    # 设置使用国内npm镜像加快速度
    npm config set proxy http://username:password@host:port
    npm config set https-proxy http://username:password@host:port
    # 前两个proxy，是为了应对用了部分github包，要连接github下载
    ```
- 在android目录下新建keystore.properties文件，填入签名信息。具体password等见个人密码库。storeFile实际在android/app/下
    ```text
    storeFile=./lxmusic.jks
    storePassword=
    keyAlias=
    keyPassword=
    ```
- 使用Android Studio打开项目根目录下的android文件夹，同步gradle。gradle也是要代理的，如果android studio设置了代理，会询问是否应用到gradle中

# 调试APP
- npm run dev就行
- 模拟器如果无法联网，注意先关闭电脑clash verge之类的网络代理软件，然后在模拟器的设置中，停用数据，使用WiFi，并将DHCP改为静态分配，IP和网关设置为原先DHCP的结果，DNS设置为正常可用的DNS。（务必确保连接了WiFi，否则可能连不上本地的Metro）
- 但是感觉bluestacks比自带的模拟器资源占用少一点，如果要用bluestacks，先启动，在设置里打开adb，然后
    ```bash
    adb connect 127.0.0.1:xxxx
    adb devices # 检查下连接上了没有
    npm run dev
    # 建议这几个命令在vscode或者独立powershell窗口执行。在android studio自带终端好像还是调用了自带的模拟器
    ```

# 编译apk
- 进入android文件夹，在android文件夹下执行`./gradlew assembleRelease`，构建的安装包在`android/app/build/outputs/apk/release/`下。注意首次编译需要挂代理（建议直接电脑全局代理而不是设置http_proxy），或者参考https://juejin.cn/post/7263035160622317626 单独下载第三方包